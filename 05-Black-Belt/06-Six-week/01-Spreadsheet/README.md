# Задание по программированию «Электронная таблица»

В этой задаче мы используем накопленные знания для создания движка электронной таблицы, такой как Microsoft Excel или Google Spreadsheets (мы будем называть эти продукты существующими решениями).

Интерфейс таблицы описывается классом ISheet из файла common.h. Сама таблица создаётся функцией CreateSheet() из того же файла. Вам нужно будет предоставить её реализацию. Также нужно будет предоставить реализацию всех остальных методов и функций из файла common.h (например, методов классов Position, Size и FormulaError).

В качестве решения можно будет сдавать несколько файлов, которые содержат все необходимые реализации.

## Общее описание

### Ячейки

Таблица состоит из ячеек. Для пользователя ячейки задаются своим индексом, т.е. строкой вида "А1" или "С14", или "RD2". Программно положение ячейки описывается позицией, т.е. номерами её строки и столбца, которые представлены классом Position. Причём номера строк и столбцов начинаются с нуля, как это принято в С++. Например, индексу "А1" соответствует позиция (0, 0), а индексу "AB15" - позиция (14, 27). Преобразования между индексом и позицией осуществляются методами Position::FromString() и Position::ToString() (их вам тоже нужно будет реализовать).

Для определённости мы будем полагать, что количество строк и столбцов в нашей таблице не будет превышать 16384. То есть максимальная позиция ячейки составит (16383, 16383) с индексом "XFD16384".

Для получения ячейки с заданной позицией используется метод ISheet::GetCell(). Он возвращает указатель на объект класса ICell. С его помощью можно получить текст и значение ячейки. Текст - это "сырое" содержимое ячейки, а значение - это "отображаемое" содержимое. В существующих решениях текст доступен только во время редактирования ячеек, а значения отображаются всё остальное время.

Ячейка считается пустой, если вызов GetCell() вернул nullptr, либо если её текст пуст.

В существующих решениях ячейка может содержать данные множества разных форматов: простые текстовые данные, численные значения, валюта, дата, и т.п. В данной задаче мы ограничимся только двумя типами: простой текст (std::string) и числа с плавающей запятой (double). Причём последние могут появиться только как результат вычисления значения формул.

### Формулы

Ячейка трактуется как формула в случае, если её текст начинается со знака "=" (и на этом не заканчивается, то есть текст, которые содержит только этот знак, формулой не считается). То, что следует после знака "=", называется выражением формулы. Выражение формулы - это простое арифметическое выражение, которое может содержать следующие элементы:

- Числа (5, 3.14)
- Бинарные операции (1\*3+4\/2-5)
- Ссылки на другие ячейки (А1+B2\*C3)

В отличие от существующих решений, результатом вычисления формулы может быть только число. То есть формула не может быть использована, например, для конкатенации строк. Если формула ссылается на другую ячейку, которая не содержит формулу, то её текст трактуется как число. Если эта ячейка пустая, то её значение полагается равным нулю.

Получается, что, если в ячейке записана формула, то текстом ячейки является знак равенства и выражение формулы, а значением ячейки является число - вычисленное значение формулы. Если в ячейке записан простой текст, то значение ячейки обычно совпадает с её текстом. Кроме случая, когда текст начинается с символа "'" (апостроф). Тогда в значении ячейки этот символ не присутствует. Это можно использовать, если нужно начать текст со знака "=", но чтобы он не интерпретировался как формула.

Содержимое ячейки задаётся методом ISheet::SetCell(), в который передаётся текст ячейки. Далее реализация сама решает, как интерпретировать этот текст.

### Вставка и удаление строк и столбцов
Важно отметить, что в таблицу можно вставлять строки и столбцы и удалять их. Поддержка такой операции делает реализацию значительно более интересной. Рассмотрим такой пример (здесь приведены тексты ячеек):

| | A | B |
|-|---|---|
|1|42|43|
|2|=A1|=A2+B1|

Если вызвать для такой таблицы InsertCols(1) (то есть вставить столбец перед столбцом "B", который является первым столбцом, если считать с нуля), то мы получим таблицу 


| | A | B | C |
|-|---|---|---|
|1|42| |43|
|2|=A1| |=A2+B1|

Обратите внимание, что ячейка "B2" теперь "переехала" в "С2", и её текст изменился. Имеет смысл пользоваться ментальной моделью, в соответствии с которой "B1" до вставки и "С1" после вставки - суть одна и та же ячейка, у которой просто изменился индекс. И подобные изменения индекса должны быть отражены во всех релевантных формулах.

Таким образом, при вставке строк или столбцов могут изменяться тексты ячеек с формулами, но значения ячеек не меняются.

С удалением ячеек дело обстоит чуть сложнее. Рассмотрим тот же пример, только вызовем для него DeleteCols(0) (то есть удалить столбец "A"). Тогда мы получим следующую таблицу:

| | A |
|-|---|
|1|43|
|2|=#REF!+A1|

Второе слагаемое в бывшей ячейке "B2" обновилось корректно, а первое заменилось на "#REF!". Это сообщение об ошибке, которое значит, что мы пытаемся обратиться к недоступной ячейке. Что логично, она ведь была удалена. Вычисление значения такой формулы вернёт нам не численное значение, а эту самую ошибку. Это отражено в типе ICell::Value - он может содержать либо простой текст, либо число, либо ошибку.

Таким образом, при удалении строк или столбцов могут изменяться как тексты ячеек с формулами, так и их значения. При этом, в качестве новых значений могут фигурировать сообщениями об ошибках.

